= JavaScript SDK for Data Transforms
:description: Work with data transforms using JavaScript.

This page contains the API reference for the data transforms JavaScript SDK.

[[OnRecordWritten]]
== Function: onRecordWritten()

**onRecordWritten**(`cb`): `void`

Registers a callback to be fired when a record is written to the input topic. This callback is triggered after the record has been written, fsynced to disk, and acknowledged by the producer. This method should be called in your script's entry point.

=== Parameters

- <<OnRecordWrittenCallback, `cb`>>

=== Returns

`void`

=== Example

```ts
import {onRecordWritten} from "@redpanda-data/transform-sdk";

// Copy the input data to the output topic.
onRecordWritten((event, writer) => {
  writer.write(event.record);
});
```

[[OnRecordWrittenCallback]]
== Callback: OnRecordWrittenCallback()

**OnRecordWrittenCallback**: (`event`, `writer`) => `void`

The callback type for <<OnRecordWritten, `OnRecordWritten`>>.

=== Parameters

- <<OnRecordWrittenEvent, `event`>>: : The event object representing the written record.

- <<RecordWriter, `writer`>>: The writer object used to write transformed records to the output topics.

=== Returns

`void`

[[OnRecordWrittenEvent]]
== Interface: OnRecordWrittenEvent

An event generated after a write event within the broker.

=== Properties

- <<WrittenRecord, `record`>> (read only): The record that was written as part of this event.

[[Record]]
== Interface: Record

A record within Redpanda, generated as a result of any transforms acting upon
a written record.

=== Properties

- <<RecordHeader, `headers`>> (optional, read only): The headers attached to this record.

- `key` (optional, read only): The key for this record. The key can be a `string`, `ArrayBuffer`, `Uint8Array`, or <<RecordData, `RecordData`>>.

- `value` (optional, read only): The value for this record. The value can be a `string`, `ArrayBuffer`, `Uint8Array`, or <<RecordData, `RecordData`>>.

[[RecordData]]
== Interface: RecordData

A wrapper around the underlying raw data in a record, similar to a JavaScript response object.

=== Methods

- `array()`: Returns the data as a raw byte array (`Uint8Array`).

- `json()`: Parses the data as JSON. This is a more efficient version of `JSON.parse(text())`. Returns the parsed JSON. Throws an error if the payload is not valid JSON.

- `text()`: Parses the data as a UTF-8 string. Returns the parsed string. Throws an error if the payload is not valid UTF-8.

[[RecordHeader]]
== Interface: RecordHeader

Records may have a collection of headers attached to them. Headers are opaque to the broker and are only a mechanism for the producer and consumers to pass information.

=== Properties

- `key` (optional, read only): The key for this header. The key can be a `string`, `ArrayBuffer`, `Uint8Array`, or <<RecordData, `RecordData`>>.

- `value` (optional, read only): The value for this header. The value can be a `string`, `ArrayBuffer`, `Uint8Array`, or <<RecordData, `RecordData`>>.

[[RecordWriter]]
== Interface: RecordWriter

A writer for transformed records that are written to the output
topics.

== Methods

- `write(<<record>>)`: Write a record to the output topic. Returns `void`. Throws an error if there are errors writing the record.

[[WrittenRecord]]
== Interface: WrittenRecord

A persisted record written to a topic within Redpanda. It is similar to a `Record`, except that it only contains `RecordData` or `null`.

=== Properties

- <<RecordHeader, `headers`>> (read only): The headers attached to this record.

- `key` (read only): The key for this record.

- <<RecordData, `value`>> (optional, read only): The value for this record.

[[WrittenRecordHeader]]
== Interface: WrittenRecordHeader

Records may have a collection of headers attached to them. Headers are opaque to the broker and are only a mechanism for the producer and consumers to pass information. This interface is similar to a <<RecordHeader, `RecordHeader`>>, except that it only contains `RecordData` or `null`.

=== Properties

- `key` (optional, read only): The key for this header.

- `value` (optional, read only): The value for this header.

[[newClient]]
== Function: newClient()

**newClient**(): <<SchemaRegistryClient`SchemaRegistryClient`>>

Returns a client interface for interacting with Redpanda Schema Registry.

=== Returns

<<SchemaRegistryClient`SchemaRegistryClient`>>

=== Example

```js
import { newClient, SchemaFormat } from "@redpanda-data/sr";

var sr_client = newClient();
const schema = {
  type: "record",
  name: "Example",
  fields: [
    { "name": "a", "type": "long", "default": 0 },
    { "name": "b", "type": "string", "default": "" }
  ]
};

const subj_schema = sr_client.createSchema(
  "avro-value",
  {
    schema: JSON.stringify(schema),
    format: SchemaFormat.Avro,
    references: [],
  }
);
```

[[decodeSchemaID]]
== Function: decodeSchemaID()

**decodeSchemaID**(`buf`): <<DecodeResult, `DecodeResult`>>

=== Parameters

- `buf`: `string`, `ArrayBuffer`, or `Uint8Array`

=== Returns

<<DecodeResult, `DecodeResult`>> in the same type as the given argument.

[[DecodeResult]]
== Interface: DecodeResult

The result of a <<decodeSchemaID, `decodeSchemaID`>> function.

=== Properties

- `id` (read only): The decoded Schema ID
- `rest` (read only): The remainder of the input buffer after stripping the encoded ID.

== Interface: Reference

=== Properties

- `name`: `string`

- `subject`: `string`

- `version`: `number`

== Interface: Schema

=== Properties

- `format` (read only): <<SchemaFormat, `SchemaFormat`>>

- `references` (read only): <<Reference, `Reference`>>

- `schema` (read only): `string`

[[SchemaRegistryClient]]
== Interface: SchemaRegistryClient

Client interface for interacting with Redpanda Schema Registry.

=== Methods

- `createSchema(subject (string), <<Schema, schema>>)`: <<SubjectSchema, `SubjectSchema`>>

- `lookupLatestSchema(subject (string))`: <<SubjectSchema, `SubjectSchema`>>

- `lookupSchemaById(id (number))`: <<Schema, `Schema`>>

- `lookupSchemaByVersion(subject (string), version (number))`: <<SubjectSchema, `SubjectSchema`>>

[[SubjectSchema]]
== Interface: SubjectSchema

=== Properties

- `id` (read only): `number`

- `schema` (read only): <<Schema, `Schema`>>

- `subject` (read only): `string`

- `version` (read only): `number`

[[SchemaFormat]]
== Enumeration: SchemaFormat

=== Enumeration Members

- Avro: `0`

- Protobuf: `1`

- JSON: `2`