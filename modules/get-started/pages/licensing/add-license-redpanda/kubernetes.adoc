= Apply an Enterprise Edition License to Redpanda in Kubernetes
:description: Learn how to apply or update a Redpanda Enterprise Edition license in a Kubernetes environment.

To enable xref:get-started:licensing/overview.adoc[enterprise features for Redpanda Self-Managed], it must have an Enterprise Edition license. This guide outlines how to apply or update an Enterprise Edition license for Redpanda Self-Managed in a Kubernetes environment.

== Prerequisites

You must have an Enterprise Edition license. If you don't have a license yet, https://www.redpanda.com/contact[request one^].

== Add a new license

Redpanda supports two ways to apply a new license in Kubernetes:

- <<secret, Use a Kubernetes Secret to store the license>>.
- <<inline, Provide the license string inline in your Helm values or manifest file>>.

[[secret]]
=== Use a Kubernetes Secret

You can store the license in a Kubernetes Secret and reference it in your Helm values or manifest file.

// tag::secret-license[]
. Download your license file (`redpanda.license`) and create a Kubernetes Secret:
+
[,bash]
----
kubectl create secret generic redpanda-license
--from-file=license=./redpanda.license
--namespace <namespace>
----
+
This command creates a Secret named `redpanda-license` in the specified namespace, containing the license file.

. Reference the secret:
+
[tabs]
======
Helm + Operator::
+
--
.`redpanda-cluster.yaml`
[,yaml]
----
apiVersion: cluster.redpanda.com/v1alpha2
kind: Redpanda
metadata:
  name: redpanda
spec:
  chartRef: {}
  clusterSpec:
    enterprise:
      licenseSecretRef:
        name: redpanda-license
        key: license
----

```bash
kubectl apply -f redpanda-cluster.yaml --namespace <namespace>
```

--
Helm::
+
--

[tabs]
====
--values::
+
.`redpanda-license.yaml`
[source,yaml]
----
enterprise:
  licenseSecretRef:
    name: redpanda-license
    key: license
----
+
```bash
helm upgrade --install redpanda redpanda/redpanda --namespace <namespace> --create-namespace \
  --values redpanda-license.yaml --reuse-values
```

--set::
+
[,bash]
----
helm upgrade --install redpanda redpanda/redpanda \
  --namespace <namespace> \
  --create-namespace \
  --set enterprise.licenseSecretRef.name=redpanda-license \
  --set enterprise.licenseSecretRef.key=license
----

====
--
======
// end::secret-license[]

[[inline]]
=== Provide the license inline

If you prefer to provide the license string directly, you can do so as follows:

[tabs]
======
Helm + Operator::
+
--
.`redpanda-cluster.yaml`
[,yaml]
----
apiVersion: cluster.redpanda.com/v1alpha2
kind: Redpanda
metadata:
  name: redpanda
spec:
  chartRef: {}
  clusterSpec:
    enterprise:
      license: <license-key>
----

```bash
kubectl apply -f redpanda-cluster.yaml --namespace <namespace>
```

--
Helm::
+
--

[tabs]
====
--values::
+
.`redpanda-license.yaml`
[source,yaml]
----
enterprise:
  license: <license-key>
----
+
```bash
helm upgrade --install redpanda redpanda/redpanda --namespace <namespace> --create-namespace \
  --values redpanda-license.yaml --reuse-values
```

--set::
+
[,bash]
----
helm upgrade --install redpanda redpanda/redpanda \
  --namespace <namespace> \
  --create-namespace \
  --set enterprise.license=<license-key>
----

====
--
======

If neither the Secret nor the license string is provided, Redpanda looks for the license at `/etc/redpanda/redpanda.license`.

== Update an existing license

The process for updating a license depends on how it was originally applied:

- <<secret-update, Update the Kubernetes Secret>>.
- <<inline-update, Update the license string inline in your Helm values or manifest file>>.

When a new license is uploaded, enterprise features in Redpanda Self-Managed are available immediately. However, to enable enterprise features in Redpanda Console, you must restart the Redpanda Console instance.

[[secret-update]]
=== Update the Kubernetes Secret

If the license is provided through a Kubernetes Secret, follow these steps to update it:

. Download the updated license file and overwrite the existing `redpanda.license` file.

. Delete the existing Secret:
+
[,bash]
----
kubectl delete secret redpanda-license --namespace <namespace>
----

. Create a new Secret with the updated license:
+
[,bash]
----
kubectl create secret generic redpanda-license \
  --from-file=license=./redpanda.license \
  --namespace <namespace>
----
+
NOTE: The Redpanda brokers do not need to be restarted after updating the license secret. The new license will automatically take effect.

. Check the status of new license to make sure it was successfully applied:
+
[,bash]
----
rpk cluster license info
----
+
The output displays the following details:
+
----
Organization:    Organization the license was generated for.
Type:            Type of license.
Expires:         Expiration date of the license.
Version:         License schema version.
----

. If you use Redpanda Console, delete the Redpanda Console Pods to force Redpanda Console to reload the updated license:
+
[,bash]
----
kubectl delete pod $(kubectl get pod --namespace <namespace> | grep redpanda-console | awk '{print $1}') --namespace <namespace>
----

[[inline-update]]
=== Update the license inline

If you applied the license inline, update it by following these steps:

. Modify the `enterprise.license` value with the new license string:
+
[tabs]
======
Helm + Operator::
+
--
.`redpanda-cluster.yaml`
[,yaml]
----
apiVersion: cluster.redpanda.com/v1alpha2
kind: Redpanda
metadata:
  name: redpanda
spec:
  chartRef: {}
  clusterSpec:
    enterprise:
      license: <license-key>
----

```bash
kubectl apply -f redpanda-cluster.yaml --namespace <namespace>
```

--
Helm::
+
--

[tabs]
====
--values::
+
.`redpanda-license.yaml`
[source,yaml]
----
enterprise:
  license: <license-key>
----
+
```bash
helm upgrade --install redpanda redpanda/redpanda --namespace <namespace> --create-namespace \
  --values redpanda-license.yaml --reuse-values
```

--set::
+
[,bash]
----
helm upgrade --install redpanda redpanda/redpanda \
  --namespace <namespace> \
  --create-namespace \
  --set enterprise.license=<license-key>
----

====
--
======

. Check the status of new license to make sure it was successfully applied:
+
[,bash]
----
rpk cluster license info
----
+
The output displays the following details:
+
----
Organization:    Organization the license was generated for.
Type:            Type of license:.
Expires:         Expiration date of the license.
Version:         License schema version.
----

. If you use Redpanda Console, delete the Redpanda Console Pods to force a reload of the updated license:
+
[,bash]
----
kubectl delete pod $(kubectl get pod --namespace <namespace> | grep redpanda-console | awk '{print $1}') --namespace <namespace>
----

== Next steps

xref:get-started:licensing/monitor-license-status.adoc[].