= Authentication
:description: Authentication in Redpanda Console lets users log in and optionally forward their credentials to the connected Redpanda cluster, ensuring all API requests are executed under the user's identity.
:page-aliases: console:single-sign-on/authentication.adoc, manage:security/console/authentication.adoc, console:config/security/plain.adoc, console:config/security/okta.adoc, console:config/security/generic-oidc.adoc, console:config/security/keycloak.adoc, console:config/security/github.adoc, console:config/security/google.adoc, console:config/security/azure-ad.adoc

// ========================AUTOMATED TESTS===================================
// The comments in this file are used to run automated tests of the documented steps. Tests are run using GitHub Actions on each pull request that changes this file in the upstream repository. For more details about the testing tool we use, see https://doc-detective.com/.

// (test start {"id": "console-authentication", "description": "Generate screenshot of Console login screen"})
// (step {"action":"runShell", "command": "docker compose up -d --wait", "workingDirectory": "../console-login", "timeout": 50000, "exitCodes": [0,1]})
// (step {"action":"wait", "duration": 20000})
// (step {"action":"goTo", "url": "http://localhost:8080/login"})
// (step {"action":"wait", "duration": 10000})
// (step {"action":"saveScreenshot", "path": "login.png", "directory": "../../modules/console/images", "overwrite": "byVariation"})
// (step {"action":"runShell", "command": "docker compose down -v", "workingDirectory": "../console-login"})
// (test end)

[NOTE]
====
include::shared:partial$enterprise-and-console.adoc[]
====

This topic describes how to enable authentication in Redpanda Console and explains how it interacts with the Kafka, Admin, and Schema Registry APIs in Redpanda.

Authentication in Redpanda Console lets users log in and optionally forward their credentials to the connected Redpanda cluster, ensuring API requests are executed under the user's identity. Redpanda Console supports two login authentication methods:

* **OIDC (OpenID Connect):**
  Uses external identity providers, such as Google, to facilitate single sign-on (SSO).
* **Basic authentication:**
  Provides a traditional username and password login.

image::console:login.png[]

== How authentication works in Redpanda Console

Redpanda Console authenticates to the Kafka, Admin, and Schema Registry APIs (Redpanda APIs) in one of two ways:

- *User impersonation*: When you log in, your credentials are used to authenticate with all Redpanda APIs that have `impersonateUser` set to `true` in the Redpanda Console configuration. Actions performed using these credentials are audited in Redpanda.

- *Static credentials*: For ancillary services, such as Kafka Connect and Git, Redpanda Console uses static credentials defined in the configuration file. You can also configure static credentials for the Redpanda APIs.

[mermaid]
....
flowchart TD
    A((User authenticates with<br/>OIDC or SASL credentials)) --> B[Redpanda Console]

    B --> C["Re-use OIDC token or basic credentials<br/>(if configured)"]
    B --> D[Get credentials<br/>from Console config]

    C --> E[Kafka API]
    C --> F[Admin API]
    C --> G[Schema API]
    E & F & G --> H((Redpanda))

    D --> J[Kafka Connect API]
    D --> L[Git]
....

When a user logs in successfully through OIDC or basic authentication, Redpanda Console creates a secure session by generating a JWT. This JWT is signed with a secret defined in `authentication.jwtSigningKey` and, if configured, stored as a secure cookie. The token encapsulates the user's credentials, which is either an ID token from an OIDC provider or the username/password provided by basic authentication, and serves as the basis for authenticating API requests.

[mermaid]
....
flowchart TD
    A[User login attempt] --> B{Select auth method}

    %% OIDC flow
    B -- OIDC --> C[Redirect to identity provider]
    C --> D[User authenticates & receives ID token]
    D --> E[Generate JWT with ID token]

    %% Basic flow
    B -- Basic --> F[Submit username/password]
    F --> G[Validate credentials]
    G --> H[Generate JWT with credentials]

    %% Unified session
    E & H --> I[Store JWT as secure cookie]
    I --> J[User makes API call]

    %% API selection
    J --> K{Which API?}
    K -- "Kafka API" --> L[Check Kafka impersonation setting]
    K -- "Schema registry API" --> M[Check schema registry impersonation setting]
    K -- "Admin API" --> N[Check admin API impersonation setting]

    %% Kafka API branch
    subgraph KafkaFlow [Kafka API flow]
      L --> O{User impersonation enabled?}
      O -- Yes --> P["Forward JWT credentials\n(SASL-OAUTHBEARER or SASL-SCRAM)"]
      O -- No --> Q[Use static credentials\n+ enforce console RBAC]
    end

    %% Schema registry branch
    subgraph SchemaRegistryFlow [Schema registry API flow]
      M --> R{User impersonation enabled?}
      R -- Yes --> S[Forward JWT credentials\nheader-based authentication]
      R -- No --> T[Use static credentials\n+ enforce console RBAC]
    end

    %% Admin API branch
    subgraph AdminAPIFlow [Admin API flow]
      N --> U{User impersonation enabled?}
      U -- Yes --> V[Forward JWT credentials\nheader-based authentication]
      U -- No --> W[Use static credentials\n+ enforce console RBAC]
    end
....

=== OIDC authentication

When using OIDC, the user is redirected to an external identity provider, such as Google, for authentication. Upon successful login, the provider issues an ID token which is then captured and encapsulated within a JWT. This token is used in the following ways:

* **Kafka authentication:**
  The ID token is mapped to SASL-OAUTHBEARER, allowing Kafka to authenticate requests under the user's identity.

* **HTTP API authentication:**
  The ID token is used in header-based authentication (`Authorization: Bearer <id-token>`) in the Schema Registry and Admin API.

Redpanda must be configured with OIDC authentication for its APIs. The OIDC configurations across these APIs must match. Using a consistent identity provider avoids authentication mismatches and ensures seamless integration

=== Basic authentication

For basic authentication, the user submits a username and password directly to Redpanda Console. These credentials are validated and encapsulated within a JWT, which is then used as follows:

* **Kafka authentication:**
  The provided credentials are mapped to SASL-SCRAM, ensuring that Kafka operations execute with the correct user identity.

* **HTTP API authentication:**
  The JWT supports HTTP Basic authentication for other APIs.

== Prerequisites

To log in to Redpanda Console, the credentials you use must correspond to an existing user in your Redpanda cluster. When you attempt to log in, Redpanda Console verifies access by checking that the provided credentials can successfully authenticate with the Kafka API. If the credentials are not valid, you cannot log in. As a result, the authentication mechanism configured in Redpanda Console must match the mechanism set up on the Kafka API for that user. For example:

- *OIDC:* If you want to log into Redpanda Console with OIDC, you must have SASL-OAUTHBEARER authentication configured for the Kafka API.
- *Basic:* If you want to log into Redpanda Console with basic authentication (username/password), you must have SASL-SCRAM authentication configured for the Kafka API.

See xref:manage:security/authentication.adoc[Configure Authentication for Redpanda].

[[enable-authentication]]
== Enable authentication for Redpanda Console

You can enable OIDC and basic authentication for Redpanda Console. OIDC is best for production environments, as it provides a secure, single sign-on experience for users. Basic authentication is useful for when you need a simple login mechanism.

You can enable both OIDC and basic authentication simultaneously. If you enable both, Redpanda Console presents users with a choice of login methods.

=== Enable OIDC authentication

To enable OIDC authentication, configure your OIDC settings in the Redpanda Console configuration file.

[,yaml]
----
authentication:
  jwtSigningSecret: "<secret-key>"  <1>
  useSecureCookies: true  <2>
  oidc:
    enabled: true  <3>
    issuerUrl: "https://accounts.google.com"  <4>
    clientId: "<oidc-client-id>"  <5>
    clientSecret: "<oidc-client-secret>"  <6>
    issuerTls:
      enabled: true  <7>
      caFilepath: "/path/to/ca.pem"
      certFilepath: "/path/to/issuer-cert.pem"
      keyFilepath: "/path/to/issuer-key.pem"
      insecureSkipTlsVerify: false
    redirectUrl: "http://localhost:8080/auth/callbacks/oidc" <8>
    accessType: "offline"  <9>
    prompt: "consent"  <10>
----

<1> `authentication.jwtSigningSecret` (required): The secret key used to sign JSON Web Tokens (JWTs). This key must be kept confidential to ensure the integrity of user sessions. Minimum length: 32 characters.
<2> `authentication.useSecureCookies`: A boolean flag indicating whether session cookies should be marked as secure. Set to true in production to enforce HTTPS.
<3> `authentication.oidc.enabled` (required): Enables OIDC-based authentication. When enabled, external identity providers can be used for single sign-on.
<4> `authentication.oidc.issuerUrl` (required): The URL of the OIDC identity provider.
<5> `authentication.oidc.clientId` (required): The client identifier registered with the OIDC provider during the client registration process.
<6> `authentication.oidc.clientSecret` (required): The client secret associated with the registered client identifier. This secret is used to authenticate the client to the OIDC provider.
<7> `authentication.oidc.issuerTls`: TLS configuration for securely connecting to the identity provider. Configure the CA certificate (and optionally a client certificate and key) to ensure secure communication. You need to configure TLS only if you require mTLS or if you use a self-signed certificate for your identity provider.
<8> `authentication.oidc.redirectUrl`: The URL where the identity provider redirects users after successful authentication. This URL must be registered with your IDP and must point to the `/auth/callbacks/oidc` path in Redpanda Console. If this URL is not configured, Redpanda Console constructs the URL by using the base URL from the request and adding the `/auth/callbacks/oidc` path. You may want to configure this URL if you use xref:console:config/http-path-rewrites.adoc[HTTP path rewrites].
<9> `authentication.oidc.accessType`: Controls whether a refresh token is requested. Set to `offline` (default) to request a refresh token for long-lived sessions. Set to `online` if you don't want a refresh token.
<10> `authentication.oidc.prompt`: Determines how the authorization prompt is displayed. Use `consent` (default) to force the consent screen to appear even if the user has previously authorized the application. Alternatives include `none` (no prompt) or `select_account` to allow the user to choose an account. Some IDPs require `consent` to issue a refresh token.

Then, <<api-authentication, configure API authentication>> for specific APIs.

=== Enable basic authentication

To enable basic authentication, configure your authentication settings in the Redpanda Console configuration file.

[, yaml]
----
authentication:
  jwtSigningKey: <signing key> <1>
  useSecureCookies: false <2>
  # Basic auth logins are mapped to SASL-SCRAM for Kafka.
  basic:
    enabled: true <3>
----
<1> `authentication.jwtSigningSecret` (required): The secret key used to sign JSON Web Tokens (JWTs). This key must be kept confidential to ensure the integrity and security of user sessions. Minimum length: 32 characters.
<2> `authentication.useSecureCookies`: A boolean flag indicating whether the JWT cookie should be marked as secure. Set to true in production to enforce HTTPS.
<3> `authentication.basic.enabled` (required): Enables or disables basic (username/password) authentication. When enabled, credentials are mapped to SASL-SCRAM for Kafka.

Then, <<api-authentication, configure API authentication>> for specific APIs.

[[api-authentication]]
== Configure API authentication

After you <<enable-authentication, enable authentication>> for Redpanda Console, you must configure how Redpanda Console authenticates to the following APIs in your Redpanda cluster:

* Kafka API
* Schema Registry
* Admin API

You have two options for each API:

* **User impersonation:**
  Redpanda Console uses the logged-in user's credentials. API requests execute under the logged-in user identity. This approach has the following advantages:
+
--
** *Accurate audit trails*: xref:manage:audit-logging.adoc[Audit logs] in Redpanda reveal the actual requester, ensuring clear accountability.
** *Unified authorization*: Authorization is enforced directly by Redpanda, aligning access control across Kafka, Schema Registry, and the Admin API.
--
In this mode, Redpanda Console's role-based access control (RBAC) is bypassed for the impersonated API calls.

* **Static credentials:**
  Redpanda Console uses static credentials provided in the configuration. Role bindings must be explicitly configured to define access permissions. This approach is useful when user impersonation is disabled or when you want to separate Redpanda Console's RBAC from the user's identity.

=== Kafka API

When user impersonation is enabled, the logged-in user's credentials are used for authentication.

.User impersonation
[source,yaml]
----
kafka:
  brokers: ["broker1.example.com:9092"]
  sasl:
    enabled: true
    impersonateUser: true
authentication:
  jwtSigningKey: "secret-key"
  basic:
    enabled: true
----

When impersonation is disabled, you must supply static credentials and role bindings to define the access permissions.

.Static credentials
[source,yaml]
----
kafka:
  brokers: ["broker1.example.com:9092"]
  sasl:
    enabled: true
    impersonateUser: false
    username: "static-kafka-user"
    password: "static-kafka-pass"
    mechanism: "SCRAM-SHA-256"
authentication:
  jwtSigningKey: "secret-key"
  basic:
    enabled: true
authorization:
  roleBindings:
  - roleName: viewer
    users:
      - loginType: basic
        name: "static-kafka-user"
----

The role binding in the configuration does not need to match the static Kafka user. In practice, most users log in using their own identity, not the static Kafka credentials. The static credentials are used only for authenticating Kafka API calls when impersonation is disabled, while role bindings govern access within Redpanda Console. This separation allows you to use a generic Kafka identity (`static-kafka-user`) without tying it to the individual login identities that benefit from personalized role-based permissions.

For more information on role bindings, see xref:console:config/security/authorization.adoc[].

=== Schema Registry API

With impersonation enabled, the Schema Registry API uses the logged-in user's credentials.

.User impersonation
[source,yaml]
----
schemaRegistry:
  urls: ["http://broker1.example.com:8081"]
  authentication:
    enabled: true
    impersonateUser: true
authentication:
  jwtSigningKey: "secret-key"
  basic:
    enabled: true
----

When impersonation is disabled and the Schema Registry API in Redpanda requires authentication, you must supply static credentials and role bindings to define the access permissions.

.Static credentials
[source,yaml]
----
schemaRegistry:
  urls: ["http://broker1.example.com:8081"]
  authentication:
    enabled: true
    impersonateUser: false
    username: "static-sr-user"
    password: "static-sr-pass"
authentication:
  jwtSigningKey: "secret-key"
  basic:
    enabled: true
authorization:
  roleBindings:
  - roleName: editor
    users:
      - loginType: basic
        name: "static-sr-user"
----

For more information on role bindings, see xref:console:config/security/authorization.adoc[].

=== Admin API

When impersonation is enabled, Admin API calls are made using the logged-in user's credentials.

.User impersonation
[source,yaml]
----
redpanda:
  adminApi:
    enabled: true
    urls: ["http://broker1.example.com:9644"]
    authentication:
      impersonateUser: true
authentication:
  jwtSigningKey: "secret-key"
  basic:
    enabled: true
----

When impersonation is disabled and the Admin API in Redpanda requires authentication, you must supply static credentials and role bindings to define the access permissions.

.Static credentials
[source,yaml]
----
redpanda:
  adminApi:
    enabled: true
    urls: ["http://broker1.example.com:9644"]
    authentication:
      impersonateUser: false
      basic:
        username: "static-admin-user"
        password: "static-admin-pass"
authentication:
  jwtSigningKey: "secret-key"
  basic:
    enabled: true
authorization:
  roleBindings:
  - roleName: admin
    users:
      - loginType: basic
        name: "static-admin-user"
----

For more information on role bindings, see xref:console:config/security/authorization.adoc[].

== Next steps

- xref:console:config/security/authorization.adoc[Redpanda Console Authorization]

