= EventRouter (Debezium)
:description: How to set EventRouter (Debezium) Single Message Transform for a connector.
:page-cloud: true

The outbox pattern is a way to safely and reliably exchange data between multiple (micro) services. An outbox pattern implementation avoids inconsistencies between a serviceâ€™s internal state (as typically persisted in its database) and state in events consumed by services that need the same data.

To implement the outbox pattern in a Debezium application, configure a Debezium connector to:

* Capture changes in an outbox table
* Apply the Debezium outbox EventRouter Single Message Transformation

NOTE: EventRouter SMT is available for managed Debezium connectors only.

== Configuration

|=== 
| Property key | Description

| `route.by.field`
| Specifies the name of a column in the outbox table. The default behavior is that the value in this column becomes a part of the name of the topic to which the connector emits the outbox messages.

| `route.topic.replacement`
| Specifies the name of the topic to which the connector emits outbox messages. The default topic name is `outbox.event.` followed by the `aggregatetype` column value in the outbox table record.

| `table.expand.json.payload`
| Specifies whether the JSON expansion of a String payload should be done. If no content found or in case of parsing error, the content is kept "as is".

| `fields.additional.placement`
| Specifies one or more outbox table columns that you want to add to outbox message headers or envelopes. Specify a comma-separated list of pairs. In each pair, specify the name of a column and whether you want the value to be in the header or the envelope.

| `table.field.event.key`
| Specifies the outbox table column that contains the event key. When this column contains a value, the SMT uses that value as the key in the emitted outbox message. This is important for maintaining correct order in Kafka partitions.
|===

== Example

Sample JSON configuration:

----
"transforms": "outbox",
"transforms.outbox.route.by.field": "type",
"transforms.outbox.route.topic.replacement": "my-topic.${routedByValue}",
"transforms.outbox.table.expand.json.payload": "true",
"transforms.outbox.table.field.event.key": "aggregate_id",
"transforms.outbox.table.fields.additional.placement": "before:envelope",
"transforms.outbox.type": "io.debezium.transforms.outbox.EventRouter"
----

== Suggested reading

* https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html[Debezium Outbox Event Router SMT^]
